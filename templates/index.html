<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relocate - Mapa de Alcance CABA</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar con controles -->
        <aside class="sidebar">
            <div class="logo">
                <h1>ğŸ“ Relocate</h1>
                <p>Â¿DÃ³nde puedo vivir cerca de mi trabajo?</p>
            </div>
            
            <div class="controls">
                <!-- Input de direcciÃ³n -->
                <div class="control-group">
                    <label for="address">ğŸ“ UbicaciÃ³n del trabajo</label>
                    <p class="help-text">ğŸ’¡ HacÃ© clic en el mapa o buscÃ¡ una direcciÃ³n</p>
                    <div class="input-with-button">
                        <input type="text" id="address" placeholder="Ej: Av. Corrientes 1234, CABA">
                        <button id="search-btn" class="btn-icon">ğŸ”</button>
                    </div>
                    <div id="geocode-results" class="results-list"></div>
                </div>
                
                <!-- Modo de visualizaciÃ³n -->
                <div class="control-group">
                    <label>ğŸ‘ï¸ Modo de visualizaciÃ³n</label>
                    <div class="view-modes">
                        <button class="view-mode-btn active" data-view="single">
                            <span>1ï¸âƒ£ Un modo a la vez</span>
                            <small>MÃ¡s claro y simple</small>
                        </button>
                        <button class="view-mode-btn" data-view="compare">
                            <span>2ï¸âƒ£ Comparar modos</span>
                            <small>Ver diferencias</small>
                        </button>
                    </div>
                </div>
                
                <!-- Selector de modo de transporte -->
                <div class="control-group" id="primary-mode-group">
                    <label>ğŸš— Medio de transporte principal</label>
                    <div class="transport-options" id="transport-modes">
                        <button class="transport-btn active" data-mode="walking">
                            <span class="icon">ğŸš¶</span>
                            <span>Caminando</span>
                        </button>
                        <button class="transport-btn" data-mode="bike">
                            <span class="icon">ğŸš²</span>
                            <span>Bici</span>
                        </button>
                        <button class="transport-btn" data-mode="car">
                            <span class="icon">ğŸš—</span>
                            <span>Auto</span>
                        </button>
                        <button class="transport-btn" data-mode="public_transport">
                            <span class="icon">ğŸšŒ</span>
                            <span>PÃºblico</span>
                        </button>
                    </div>
                </div>
                
                <!-- Modo secundario (solo en modo comparar) -->
                <div class="control-group" id="secondary-mode-group" style="display: none;">
                    <label>ğŸš— Comparar con (opcional)</label>
                    <div class="transport-options" id="transport-modes-secondary">
                        <button class="transport-btn" data-mode="walking">
                            <span class="icon">ğŸš¶</span>
                            <span>Caminando</span>
                        </button>
                        <button class="transport-btn active" data-mode="bike">
                            <span class="icon">ğŸš²</span>
                            <span>Bici</span>
                        </button>
                        <button class="transport-btn" data-mode="car">
                            <span class="icon">ğŸš—</span>
                            <span>Auto</span>
                        </button>
                        <button class="transport-btn" data-mode="public_transport">
                            <span class="icon">ğŸšŒ</span>
                            <span>PÃºblico</span>
                        </button>
                    </div>
                    <p class="help-text">ğŸ’¡ El modo secundario se muestra solo con contorno</p>
                </div>
                
                <!-- Selector de tiempo -->
                <div class="control-group">
                    <label>â±ï¸ Tiempos <small>(seleccionÃ¡ preset o agregÃ¡ custom)</small></label>
                    <div class="time-options multi-select" id="time-ranges">
                        <button class="time-btn active" data-minutes="15">
                            <span class="badge green"></span>
                            15 min
                        </button>
                        <button class="time-btn active" data-minutes="30">
                            <span class="badge yellow"></span>
                            30 min
                        </button>
                        <button class="time-btn active" data-minutes="45">
                            <span class="badge orange"></span>
                            45 min
                        </button>
                        <button class="time-btn active" data-minutes="60">
                            <span class="badge red"></span>
                            60 min
                        </button>
                    </div>
                    
                    <!-- Tiempo personalizado -->
                    <div class="custom-time-row">
                        <input type="number" id="custom-time" placeholder="Ej: 20" min="5" max="120" step="5">
                        <span>minutos</span>
                        <button id="add-time-btn" class="btn-small">Agregar</button>
                    </div>
                    <div id="custom-times-list" class="custom-times-list"></div>
                </div>
                
                <!-- Opciones de visualizaciÃ³n -->
                <div class="control-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-transport-layer" checked>
                        <span>Mostrar transporte pÃºblico</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-mode">
                        <span>ğŸ”§ Ver cÃ­rculos de cÃ¡lculo</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-hull-only" checked>
                        <span>Mostrar solo envolvente (sin cÃ­rculos)</span>
                    </label>
                </div>
                
                <!-- Servicios y seguridad -->
                <div class="control-group">
                    <label>ğŸ¥ Servicios y seguridad</label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-hospitales">
                        <span>ğŸ¥ Hospitales</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-comisarias">
                        <span>ğŸ‘® ComisarÃ­as</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-barrios">
                        <span>âš ï¸ Zonas de precauciÃ³n</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-colectivos">
                        <span>ğŸšŒ Paradas de colectivo</span>
                    </label>
                </div>
                
                <!-- Botones de acciÃ³n -->
                <div class="action-buttons">
                    <button id="generate-btn" class="btn-primary" disabled>
                        Generar mapa de alcance
                    </button>
                    <button id="reset-btn" class="btn-secondary" style="display: none;">
                        ğŸ”„ Nuevo cÃ¡lculo
                    </button>
                </div>
                
                <!-- Estado -->
                <div id="status" class="status"></div>
                
                <!-- Mensaje de bloqueo -->
                <div id="block-message" class="block-message" style="display: none;">
                    âš ï¸ TenÃ©s resultados cargados. <strong>HacÃ© clic en cualquier punto del mapa</strong> para ver la ruta desde tu trabajo, o en "Nuevo cÃ¡lculo" para cambiar la ubicaciÃ³n.
                </div>
            </div>
            
            <!-- Leyenda por modo de transporte -->
            <div class="legend">
                <h4>ğŸ“Š DegradÃ© por tiempo</h4>
                <p class="legend-help">5 min â† â†’ 60+ min</p>
                
                <div class="legend-mode">
                    <div class="legend-mode-header">
                        <span>ğŸš¶</span>
                        <span>Caminando</span>
                        <span class="legend-gradient walking"></span>
                    </div>
                    <small>Casi transparente â†’ Verde intenso</small>
                </div>
                <div class="legend-mode">
                    <div class="legend-mode-header">
                        <span>ğŸš²</span>
                        <span>Bici</span>
                        <span class="legend-gradient bike"></span>
                    </div>
                    <small>Casi transparente â†’ Azul intenso</small>
                </div>
                <div class="legend-mode">
                    <div class="legend-mode-header">
                        <span>ğŸš—</span>
                        <span>Auto</span>
                        <span class="legend-gradient car"></span>
                    </div>
                    <small>Casi transparente â†’ Rojo intenso</small>
                </div>
                <div class="legend-mode">
                    <div class="legend-mode-header">
                        <span>ğŸšŒ</span>
                        <span>Transporte</span>
                        <span class="legend-gradient transport"></span>
                    </div>
                    <small>Casi transparente â†’ Violeta intenso</small>
                </div>
            </div>
            
            <!-- Info -->
            <div class="footer-info">
                <p>CABA - Argentina</p>
                <p id="demo-badge" class="demo-badge" style="display: none;">Modo Demo</p>
            </div>
        </aside>
        
        <!-- Mapa -->
        <main class="map-container">
            <div id="map"></div>
            
            <!-- Panel de capas -->
            <div id="layers-panel" class="layers-panel" style="display: none;">
                <div class="layers-header">
                    <h3>ğŸ—‚ï¸ Capas</h3>
                    <button id="toggle-all-layers" class="btn-small">Mostrar/Ocultar todo</button>
                </div>
                <div id="layers-list" class="layers-list"></div>
            </div>
            
            <!-- Overlay de carga -->
            <div id="loading" class="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p id="loading-text">Calculando Ã¡rea alcanzable...</p>
            </div>
        </main>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
</body>
</html>
